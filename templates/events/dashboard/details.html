{% extends "dashboard_base.html" %}
{% load compress %}
{% load crispy_forms_tags %}

{% block title %}
{{ event }} - Dashboard - Online
{% endblock title %}

{% block page-header %}
Arrangementsdetaljer
{% endblock %}

{% block styles %}
    {{ block.super }}
    {% compress css %}
    {{ change_event_form.media.css }}
    {{ change_attendance_form.media.css }}
    <link rel="stylesheet" type="text/less" href="{{ STATIC_URL }}less/dashboard/events.less" />
    {% endcompress %}
{% endblock %}

{% block breadcrumbs %}
    <li><a href="{% url 'dashboard_events_index' %}">Arrangementer</a></li>
    <li>{{ event }}</li>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-12">
        <h3>{{ event }}</h3>
    </div>
</div>

 <div class="row">
    <div class="col-lg-12">
        <ul class="nav nav-tabs" role="tablist">
            <li role="presentation" class="active">
                <a href="#detail" aria-controls="detail" role="tab" data-toggle="tab">Detaljer</a>
            </li>
            {% if event.attendance_event %}
                <li role="presentation">
                    <a href="#attendees" aria-controls="attendees" role="tab" data-toggle="tab">Påmelding ({{ event.attendance_event.number_of_seats_taken }}/{{ event.attendance_event.max_capacity }})</a>
                </li>
            {% else %}
                <li role="presentation">
                    <a href="#create-attendance" aria-controls="create-attendance" role="tab" data-toggle="tab"><i class="fa fa-plus"></i> Legg til påmelding</a>
                </li>
            {% endif %}
            {% if event.attendance_event.waitlist %}
                <li role="presentation">
                    <a href="#waitlist" aria-controls="waitlist" role="tab" data-toggle="tab">Venteliste ({{ event.attendance_event.number_on_waitlist }})</a>
                </li>
            {%  endif %}
            {%  if event.attendance_event.has_reservation %}
                <li role="presentation">
                    <a href="#reservees" aria-controls="reservees" role="tab" data-toggle="tab">Reservasjoner ({{ event.attendance_event.number_of_reserved_seats }})</a>
                </li>
            {%  endif %}
            {%  if event.attendance_event.has_extras %}
                <li role="presentation">
                    <a href="#extra" aria-controls="extra" role="tab" data-toggle="tab">Ekstra</a>
                </li>
            {% endif %}
            {%  if payment_prices %}
                <li role="presentation">
                    <a href="#payment-summary" aria-controls="payment-summary" role="tab" data-toggle="tab">Betalingsoppsumering</a>
                </li>
            {% endif %}
        </ul>
    </div>
</div>

<br />

<div class="tab-content">
    <div role="tabpanel" class="tab-pane active" id="detail">
        {%  include "events/dashboard/details/details.html" %}
    </div>
    <div role="tabpanel" class="tab-pane" id="attendees">
        <div class="panel-group">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h4 class="panel-title">
                <a data-toggle="collapse" href="#attendance-form">Påmeldingsinformasjon <i class="fa fa-chevron-down"></i></a>
              </h4>
            </div>
            <div id="attendance-form" class="panel-collapse collapse">
              <div id="update-attendance-view" class="panel-body"></div>
            </div>
          </div>
        </div>
        {%  include "events/dashboard/details/attendees.html" %}
    </div>
    <div role="tabpanel" class="tab-pane" id="create-attendance">
        <div id="create-attendance-view"></div>
    </div>
    <div role="tabpanel" class="tab-pane" id="waitlist">
        {%  include "events/dashboard/details/waitlist.html" %}
    </div>
    <div role="tabpanel" class="tab-pane" id="reservees">
        {%  include "events/dashboard/details/reservation.html" %}
    </div>
    <div role="tabpanel" class="tab-pane" id="extra">
        {%  include "events/dashboard/details/extra.html" %}
    </div>
<div role="tabpanel" class="tab-pane" id="payment-summary">
        {%  include "events/dashboard/details/payment_summary.html" %}
    </div>
</div>

{% endblock content %}

{% block js %}
    {{ block.super }}
    {% compress js %}
    {{ change_event_form.media.js }}
    {{ change_attendance_form.media.js }}
    <script type="text/javascript" src="{{ STATIC_URL }}js/libs/hogan-2.0.0.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/libs/typeahead.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/dashboard/events.js"></script>
    <script>
        // Update details view form with action attribute
        $('#create-event-form').attr('action', "{% url 'dashboard_events_edit' event.id %}")
        // Fetch the form used for creating an attendanceevent
        $('#create-attendance-view').load("{% url 'dashboard_event_create_attendance' event.id %}", function() {
          // Update create attendanceevent form with action attribute
          $('#create-attendance-form').attr('action', "{% url 'dashboard_event_create_attendance' event.id %}")
        })
        $('#update-attendance-view').load("{% url 'dashboard_event_create_attendance' event.id %}", function() {
          // $('#update-attendance-view').('form').attr('id', 'update-attendance-form')
          // Update create attendanceevent form with action attribute
          // $('#update-attendance-form').attr('action', "{% url 'dashboard_event_create_attendance' event.id %}")
        })
    </script>
    {% endcompress %}
{% endblock %}
